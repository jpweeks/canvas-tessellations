// Modified version of Three.js r32 - http://github.com/mrdoob/three.js
var THREE=THREE||{};THREE.Color=function(a){this.autoUpdate=true;this.setHex(a)};
THREE.Color.prototype={setRGB:function(a,b,c){this.r=a;this.g=b;this.b=c;if(this.autoUpdate){this.updateHex();this.updateStyleString()}},setHSV:function(a,b,c){var d,e,f,i,j,g;if(c==0)d=e=f=0;else{i=Math.floor(a*6);j=a*6-i;a=c*(1-b);g=c*(1-b*j);b=c*(1-b*(1-j));switch(i){case 1:d=g;e=c;f=a;break;case 2:d=a;e=c;f=b;break;case 3:d=a;e=g;f=c;break;case 4:d=b;e=a;f=c;break;case 5:d=c;e=a;f=g;break;case 6:case 0:d=c;e=b;f=a}}this.r=d;this.g=e;this.b=f;if(this.autoUpdate){this.updateHex();this.updateStyleString()}},
setHex:function(a){this.hex=~~a&16777215;if(this.autoUpdate){this.updateRGBA();this.updateStyleString()}},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGBA:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},updateStyleString:function(){this.__styleString="rgb("+~~(this.r*255)+","+~~(this.g*255)+","+~~(this.b*255)+")"},clone:function(){return new THREE.Color(this.hex)},toString:function(){return"THREE.Color ( r: "+
this.r+", g: "+this.g+", b: "+this.b+", hex: "+this.hex+" )"}};THREE.Face3=function(a,b,c,d,e){this.a=a;this.b=b;this.c=c;this.centroid=new THREE.Vector3;this.normal=d instanceof THREE.Vector3?d:new THREE.Vector3;this.vertexNormals=d instanceof Array?d:[];this.materials=e instanceof Array?e:[e]};THREE.Face3.prototype={toString:function(){return"THREE.Face3 ( "+this.a+", "+this.b+", "+this.c+" )"}};THREE.Face4=function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.d=d;this.centroid=new THREE.Vector3;this.normal=e instanceof THREE.Vector3?e:new THREE.Vector3;this.vertexNormals=e instanceof Array?e:[];this.materials=f instanceof Array?f:[f]};THREE.Face4.prototype={toString:function(){return"THREE.Face4 ( "+this.a+", "+this.b+", "+this.c+" "+this.d+" )"}};THREE.Geometry=function(){this.vertices=[];this.faces=[];this.uvs=[];this.uvs2=[];this.colors=[];this.boundingSphere=this.boundingBox=null;this.geometryChunks={};this.hasTangents=false};
THREE.Geometry.prototype={computeCentroids:function(){var a,b,c;a=0;for(b=this.faces.length;a<b;a++){c=this.faces[a];c.centroid.set(0,0,0);if(c instanceof THREE.Face3){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);c.centroid.divideScalar(3)}else if(c instanceof THREE.Face4){c.centroid.addSelf(this.vertices[c.a].position);c.centroid.addSelf(this.vertices[c.b].position);c.centroid.addSelf(this.vertices[c.c].position);
c.centroid.addSelf(this.vertices[c.d].position);c.centroid.divideScalar(4)}}},computeFaceAreas:function(){var a,b,c,d,e,f,i,j=[];a=0;for(b=this.faces.length;a<b;a++){i=this.faces[a];if(i instanceof THREE.Face3){f=[this.vertices[i.a].position,this.vertices[i.b].position,this.vertices[i.c].position];for(c=0;c<3;c++){d=f[c];e=c<2?f[c+1]:f[0];j[c]=d.clone().subSelf(e).length()}d=j[0];e=j[1];f=j[2];c=(d+e+f)/2;i.area=Math.sqrt(c*(c-d)*(c-e)*(c-f))}}},computeFaceNormals:function(a){var b,c,d,e,f,i,j=new THREE.Vector3,
g=new THREE.Vector3;d=0;for(e=this.vertices.length;d<e;d++){f=this.vertices[d];f.normal.set(0,0,0)}d=0;for(e=this.faces.length;d<e;d++){f=this.faces[d];if(a&&f.vertexNormals.length){j.set(0,0,0);b=0;for(c=f.normal.length;b<c;b++)j.addSelf(f.vertexNormals[b]);j.divideScalar(3)}else{b=this.vertices[f.a];c=this.vertices[f.b];i=this.vertices[f.c];j.sub(i.position,c.position);g.sub(b.position,c.position);j.crossSelf(g)}j.isZero()||j.normalize();f.normal.copy(j)}},computeVertexNormals:function(){var a,
b,c,d;if(this.__tmpVertices==undefined){d=this.__tmpVertices=Array(this.vertices.length);a=0;for(b=this.vertices.length;a<b;a++)d[a]=new THREE.Vector3;a=0;for(b=this.faces.length;a<b;a++){c=this.faces[a];if(c instanceof THREE.Face3)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(c instanceof THREE.Face4)c.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}else{d=this.__tmpVertices;a=0;for(b=this.vertices.length;a<b;a++)d[a].set(0,
0,0)}a=0;for(b=this.faces.length;a<b;a++){c=this.faces[a];if(c instanceof THREE.Face3){d[c.a].addSelf(c.normal);d[c.b].addSelf(c.normal);d[c.c].addSelf(c.normal)}else if(c instanceof THREE.Face4){d[c.a].addSelf(c.normal);d[c.b].addSelf(c.normal);d[c.c].addSelf(c.normal);d[c.d].addSelf(c.normal)}}a=0;for(b=this.vertices.length;a<b;a++)d[a].normalize();a=0;for(b=this.faces.length;a<b;a++){c=this.faces[a];if(c instanceof THREE.Face3){c.vertexNormals[0].copy(d[c.a]);c.vertexNormals[1].copy(d[c.b]);c.vertexNormals[2].copy(d[c.c])}else if(c instanceof
THREE.Face4){c.vertexNormals[0].copy(d[c.a]);c.vertexNormals[1].copy(d[c.b]);c.vertexNormals[2].copy(d[c.c]);c.vertexNormals[3].copy(d[c.d])}}},computeTangents:function(){function a(A,s,N,t,O,ia,J){f=A.vertices[s].position;i=A.vertices[N].position;j=A.vertices[t].position;g=e[O];h=e[ia];m=e[J];l=i.x-f.x;o=j.x-f.x;p=i.y-f.y;u=j.y-f.y;v=i.z-f.z;r=j.z-f.z;k=h.u-g.u;E=m.u-g.u;C=h.v-g.v;K=m.v-g.v;F=1/(k*K-E*C);x.set((K*l-C*o)*F,(K*p-C*u)*F,(K*v-C*r)*F);L.set((k*o-E*l)*F,(k*u-E*p)*F,(k*r-E*v)*F);P[s].addSelf(x);
P[N].addSelf(x);P[t].addSelf(x);D[s].addSelf(L);D[N].addSelf(L);D[t].addSelf(L)}var b,c,d,e,f,i,j,g,h,m,l,o,p,u,v,r,k,E,C,K,F,P=[],D=[],x=new THREE.Vector3,L=new THREE.Vector3,y=new THREE.Vector3,H=new THREE.Vector3,w=new THREE.Vector3;b=0;for(c=this.vertices.length;b<c;b++){P[b]=new THREE.Vector3;D[b]=new THREE.Vector3}b=0;for(c=this.faces.length;b<c;b++){d=this.faces[b];e=this.uvs[b];if(d instanceof THREE.Face3){a(this,d.a,d.b,d.c,0,1,2);this.vertices[d.a].normal.copy(d.vertexNormals[0]);this.vertices[d.b].normal.copy(d.vertexNormals[1]);
this.vertices[d.c].normal.copy(d.vertexNormals[2])}else if(d instanceof THREE.Face4){a(this,d.a,d.b,d.c,0,1,2);a(this,d.a,d.b,d.d,0,1,3);this.vertices[d.a].normal.copy(d.vertexNormals[0]);this.vertices[d.b].normal.copy(d.vertexNormals[1]);this.vertices[d.c].normal.copy(d.vertexNormals[2]);this.vertices[d.d].normal.copy(d.vertexNormals[3])}}b=0;for(c=this.vertices.length;b<c;b++){w.copy(this.vertices[b].normal);d=P[b];y.copy(d);y.subSelf(w.multiplyScalar(w.dot(d))).normalize();H.cross(this.vertices[b].normal,
d);d=H.dot(D[b]);d=d<0?-1:1;this.vertices[b].tangent.set(y.x,y.y,y.z,d)}this.hasTangents=true},computeBoundingBox:function(){var a;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var b=1,c=this.vertices.length;b<c;b++){a=this.vertices[b];if(a.position.x<this.boundingBox.x[0])this.boundingBox.x[0]=a.position.x;else if(a.position.x>
this.boundingBox.x[1])this.boundingBox.x[1]=a.position.x;if(a.position.y<this.boundingBox.y[0])this.boundingBox.y[0]=a.position.y;else if(a.position.y>this.boundingBox.y[1])this.boundingBox.y[1]=a.position.y;if(a.position.z<this.boundingBox.z[0])this.boundingBox.z[0]=a.position.z;else if(a.position.z>this.boundingBox.z[1])this.boundingBox.z[1]=a.position.z}}},computeBoundingSphere:function(){for(var a=this.boundingSphere===null?0:this.boundingSphere.radius,b=0,c=this.vertices.length;b<c;b++)a=Math.max(a,
this.vertices[b].position.length());this.boundingSphere={radius:a}},sortFacesByMaterial:function(){function a(m){var l=[];b=0;for(c=m.length;b<c;b++)m[b]==undefined?l.push("undefined"):l.push(m[b].toString());return l.join("_")}var b,c,d,e,f,i,j,g,h={};d=0;for(e=this.faces.length;d<e;d++){f=this.faces[d];i=f.materials;j=a(i);if(h[j]==undefined)h[j]={hash:j,counter:0};g=h[j].hash+"_"+h[j].counter;if(this.geometryChunks[g]==undefined)this.geometryChunks[g]={faces:[],materials:i,vertices:0};f=f instanceof
THREE.Face3?3:4;if(this.geometryChunks[g].vertices+f>65535){h[j].counter+=1;g=h[j].hash+"_"+h[j].counter;if(this.geometryChunks[g]==undefined)this.geometryChunks[g]={faces:[],materials:i,vertices:0}}this.geometryChunks[g].faces.push(d);this.geometryChunks[g].vertices+=f}},toString:function(){return"THREE.Geometry ( vertices: "+this.vertices+", faces: "+this.faces+", uvs: "+this.uvs+" )"}};THREE.Ray=function(a,b){this.origin=a||new THREE.Vector3;this.direction=b||new THREE.Vector3};
THREE.Ray.prototype={intersectScene:function(a){var b,c,d=a.objects,e=[];a=0;for(b=d.length;a<b;a++){c=d[a];if(c instanceof THREE.Mesh)e=e.concat(this.intersectObject(c))}e.sort(function(f,i){return f.distance-i.distance});return e},intersectObject:function(a){function b(r,k,E,C){C=C.clone().subSelf(k);E=E.clone().subSelf(k);var K=r.clone().subSelf(k);r=C.dot(C);k=C.dot(E);C=C.dot(K);var F=E.dot(E);E=E.dot(K);K=1/(r*F-k*k);F=(F*C-k*E)*K;r=(r*E-k*C)*K;return F>0&&r>0&&F+r<1}var c,d,e,f,i,j,g,h,m,l,
o,p=a.geometry,u=p.vertices,v=[];c=0;for(d=p.faces.length;c<d;c++){e=p.faces[c];l=this.origin.clone();o=this.direction.clone();f=a.matrix.multiplyVector3(u[e.a].position.clone());i=a.matrix.multiplyVector3(u[e.b].position.clone());j=a.matrix.multiplyVector3(u[e.c].position.clone());g=e instanceof THREE.Face4?a.matrix.multiplyVector3(u[e.d].position.clone()):null;h=a.rotationMatrix.multiplyVector3(e.normal.clone());m=o.dot(h);if(m<0){h=h.dot((new THREE.Vector3).sub(f,l))/m;l=l.addSelf(o.multiplyScalar(h));
if(e instanceof THREE.Face3){if(b(l,f,i,j)){e={distance:this.origin.distanceTo(l),point:l,face:e,faceID:c,object:a};v.push(e)}}else if(e instanceof THREE.Face4)if(b(l,f,i,g)||b(l,i,j,g)){e={distance:this.origin.distanceTo(l),point:l,face:e,faceID:c,object:a};v.push(e)}}}return v}};THREE.Rectangle=function(){function a(){f=d-b;i=e-c}var b,c,d,e,f,i,j=true;this.getX=function(){return b};this.getY=function(){return c};this.getWidth=function(){return f};this.getHeight=function(){return i};this.getLeft=function(){return b};this.getTop=function(){return c};this.getRight=function(){return d};this.getBottom=function(){return e};this.set=function(g,h,m,l){j=false;b=g;c=h;d=m;e=l;a()};this.addPoint=function(g,h){if(j){j=false;b=g;c=h;d=g;e=h}else{b=b<g?b:g;c=c<h?c:h;d=d>g?d:g;e=e>h?
e:h}a()};this.add3Points=function(g,h,m,l,o,p){if(j){j=false;b=g<m?g<o?g:o:m<o?m:o;c=h<l?h<p?h:p:l<p?l:p;d=g>m?g>o?g:o:m>o?m:o;e=h>l?h>p?h:p:l>p?l:p}else{b=g<m?g<o?g<b?g:b:o<b?o:b:m<o?m<b?m:b:o<b?o:b;c=h<l?h<p?h<c?h:c:p<c?p:c:l<p?l<c?l:c:p<c?p:c;d=g>m?g>o?g>d?g:d:o>d?o:d:m>o?m>d?m:d:o>d?o:d;e=h>l?h>p?h>e?h:e:p>e?p:e:l>p?l>e?l:e:p>e?p:e}a()};this.addRectangle=function(g){if(j){j=false;b=g.getLeft();c=g.getTop();d=g.getRight();e=g.getBottom()}else{b=b<g.getLeft()?b:g.getLeft();c=c<g.getTop()?c:g.getTop();
d=d>g.getRight()?d:g.getRight();e=e>g.getBottom()?e:g.getBottom()}a()};this.inflate=function(g){b-=g;c-=g;d+=g;e+=g;a()};this.minSelf=function(g){b=b>g.getLeft()?b:g.getLeft();c=c>g.getTop()?c:g.getTop();d=d<g.getRight()?d:g.getRight();e=e<g.getBottom()?e:g.getBottom();a()};this.instersects=function(g){return Math.min(d,g.getRight())-Math.max(b,g.getLeft())>=0&&Math.min(e,g.getBottom())-Math.max(c,g.getTop())>=0};this.empty=function(){j=true;e=d=c=b=0;a()};this.isEmpty=function(){return j};this.toString=
function(){return"THREE.Rectangle ( left: "+b+", right: "+d+", top: "+c+", bottom: "+e+", width: "+f+", height: "+i+" )"}};THREE.UV=function(a,b){this.u=a||0;this.v=b||0};THREE.UV.prototype={copy:function(a){this.u=a.u;this.v=a.v},toString:function(){return"THREE.UV ("+this.u+", "+this.v+")"}};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};
THREE.Vector2.prototype={set:function(a,b){this.x=a;this.y=b;return this},copy:function(a){this.x=a.x;this.y=a.y;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;return this},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;return this},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},unit:function(){this.multiplyScalar(1/this.length());return this},length:function(){return Math.sqrt(this.x*
this.x+this.y*this.y)},distanceTo:function(a){return Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2))},lengthSq:function(){return this.x*this.x+this.y*this.y},negate:function(){this.x=-this.x;this.y=-this.y;return this},clone:function(){return new THREE.Vector2(this.x,this.y)},toString:function(){return"THREE.Vector2 ("+this.x+", "+this.y+")"}};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};
THREE.Vector3.prototype={set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},
cross:function(a,b){this.x=a.y*b.z-a.z*b.y;this.y=a.z*b.x-a.x*b.z;this.z=a.x*b.y-a.y*b.x;return this},crossSelf:function(a){var b=this.x,c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this},multiply:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},multiplySelf:function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divideSelf:function(a){this.x/=a.x;this.y/=a.y;this.z/=
a.z;return this},divideScalar:function(a){this.x/=a;this.y/=a;this.z/=a;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},distanceTo:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return Math.sqrt(b*b+c*c+a*a)},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;a=this.z-a.z;return b*b+c*c+a*a},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},negate:function(){this.x=
-this.x;this.y=-this.y;this.z=-this.z;return this},normalize:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);a>0?this.multiplyScalar(1/a):this.set(0,0,0);return this},setLength:function(a){return this.normalize().multiplyScalar(a)},isZero:function(){return Math.abs(this.x)<1.0E-4&&Math.abs(this.y)<1.0E-4&&Math.abs(this.z)<1.0E-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},toString:function(){return"THREE.Vector3 ( "+this.x+", "+this.y+", "+this.z+" )"}};THREE.Vector4=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=d||1};
THREE.Vector4.prototype={set:function(a,b,c,d){this.x=a;this.y=b;this.z=c;this.w=d;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w||1;return this},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;
return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},divideScalar:function(a){this.x/=a;this.y/=a;this.z/=a;this.w/=a;return this},lerpSelf:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},toString:function(){return"THREE.Vector4 ("+this.x+", "+this.y+", "+this.z+", "+this.w+")"}};THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={transpose:function(){var a,b=this.m;a=b[1];b[1]=b[3];b[3]=a;a=b[2];b[2]=b[6];b[6]=a;a=b[5];b[5]=b[7];b[7]=a;return this},transposeIntoArray:function(a){var b=this.m;a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];return this}};THREE.Matrix4=function(a,b,c,d,e,f,i,j,g,h,m,l,o,p,u,v){this.n11=a||1;this.n12=b||0;this.n13=c||0;this.n14=d||0;this.n21=e||0;this.n22=f||1;this.n23=i||0;this.n24=j||0;this.n31=g||0;this.n32=h||0;this.n33=m||1;this.n34=l||0;this.n41=o||0;this.n42=p||0;this.n43=u||0;this.n44=v||1;this.flat=Array(16);this.m33=new THREE.Matrix3};
THREE.Matrix4.prototype={identity:function(){this.n11=1;this.n21=this.n14=this.n13=this.n12=0;this.n22=1;this.n32=this.n31=this.n24=this.n23=0;this.n33=1;this.n43=this.n42=this.n41=this.n34=0;this.n44=1;return this},set:function(a,b,c,d,e,f,i,j,g,h,m,l,o,p,u,v){this.n11=a;this.n12=b;this.n13=c;this.n14=d;this.n21=e;this.n22=f;this.n23=i;this.n24=j;this.n31=g;this.n32=h;this.n33=m;this.n34=l;this.n41=o;this.n42=p;this.n43=u;this.n44=v;return this},copy:function(a){this.n11=a.n11;this.n12=a.n12;this.n13=
a.n13;this.n14=a.n14;this.n21=a.n21;this.n22=a.n22;this.n23=a.n23;this.n24=a.n24;this.n31=a.n31;this.n32=a.n32;this.n33=a.n33;this.n34=a.n34;this.n41=a.n41;this.n42=a.n42;this.n43=a.n43;this.n44=a.n44;return this},lookAt:function(a,b,c){var d=THREE.Matrix4.__tmpVec1,e=THREE.Matrix4.__tmpVec2,f=THREE.Matrix4.__tmpVec3;f.sub(a,b).normalize();d.cross(c,f).normalize();e.cross(f,d).normalize();this.n11=d.x;this.n12=d.y;this.n13=d.z;this.n14=-d.dot(a);this.n21=e.x;this.n22=e.y;this.n23=e.z;this.n24=-e.dot(a);
this.n31=f.x;this.n32=f.y;this.n33=f.z;this.n34=-f.dot(a);this.n43=this.n42=this.n41=0;this.n44=1;return this},multiplyVector3:function(a){var b=a.x,c=a.y,d=a.z,e=1/(this.n41*b+this.n42*c+this.n43*d+this.n44);a.x=(this.n11*b+this.n12*c+this.n13*d+this.n14)*e;a.y=(this.n21*b+this.n22*c+this.n23*d+this.n24)*e;a.z=(this.n31*b+this.n32*c+this.n33*d+this.n34)*e;return a},multiplyVector4:function(a){var b=a.x,c=a.y,d=a.z,e=a.w;a.x=this.n11*b+this.n12*c+this.n13*d+this.n14*e;a.y=this.n21*b+this.n22*c+this.n23*
d+this.n24*e;a.z=this.n31*b+this.n32*c+this.n33*d+this.n34*e;a.w=this.n41*b+this.n42*c+this.n43*d+this.n44*e;return a},crossVector:function(a){var b=new THREE.Vector4;b.x=this.n11*a.x+this.n12*a.y+this.n13*a.z+this.n14*a.w;b.y=this.n21*a.x+this.n22*a.y+this.n23*a.z+this.n24*a.w;b.z=this.n31*a.x+this.n32*a.y+this.n33*a.z+this.n34*a.w;b.w=a.w?this.n41*a.x+this.n42*a.y+this.n43*a.z+this.n44*a.w:1;return b},multiply:function(a,b){var c=a.n11,d=a.n12,e=a.n13,f=a.n14,i=a.n21,j=a.n22,g=a.n23,h=a.n24,m=a.n31,
l=a.n32,o=a.n33,p=a.n34,u=a.n41,v=a.n42,r=a.n43,k=a.n44,E=b.n11,C=b.n12,K=b.n13,F=b.n14,P=b.n21,D=b.n22,x=b.n23,L=b.n24,y=b.n31,H=b.n32,w=b.n33,A=b.n34,s=b.n41,N=b.n42,t=b.n43,O=b.n44;this.n11=c*E+d*P+e*y+f*s;this.n12=c*C+d*D+e*H+f*N;this.n13=c*K+d*x+e*w+f*t;this.n14=c*F+d*L+e*A+f*O;this.n21=i*E+j*P+g*y+h*s;this.n22=i*C+j*D+g*H+h*N;this.n23=i*K+j*x+g*w+h*t;this.n24=i*F+j*L+g*A+h*O;this.n31=m*E+l*P+o*y+p*s;this.n32=m*C+l*D+o*H+p*N;this.n33=m*K+l*x+o*w+p*t;this.n34=m*F+l*L+o*A+p*O;this.n41=u*E+v*P+
r*y+k*s;this.n42=u*C+v*D+r*H+k*N;this.n43=u*K+v*x+r*w+k*t;this.n44=u*F+v*L+r*A+k*O;return this},multiplyToArray:function(a,b,c){var d=a.n11,e=a.n12,f=a.n13,i=a.n14,j=a.n21,g=a.n22,h=a.n23,m=a.n24,l=a.n31,o=a.n32,p=a.n33,u=a.n34,v=a.n41,r=a.n42,k=a.n43;a=a.n44;var E=b.n11,C=b.n12,K=b.n13,F=b.n14,P=b.n21,D=b.n22,x=b.n23,L=b.n24,y=b.n31,H=b.n32,w=b.n33,A=b.n34,s=b.n41,N=b.n42,t=b.n43;b=b.n44;this.n11=d*E+e*P+f*y+i*s;this.n12=d*C+e*D+f*H+i*N;this.n13=d*K+e*x+f*w+i*t;this.n14=d*F+e*L+f*A+i*b;this.n21=
j*E+g*P+h*y+m*s;this.n22=j*C+g*D+h*H+m*N;this.n23=j*K+g*x+h*w+m*t;this.n24=j*F+g*L+h*A+m*b;this.n31=l*E+o*P+p*y+u*s;this.n32=l*C+o*D+p*H+u*N;this.n33=l*K+o*x+p*w+u*t;this.n34=l*F+o*L+p*A+u*b;this.n41=v*E+r*P+k*y+a*s;this.n42=v*C+r*D+k*H+a*N;this.n43=v*K+r*x+k*w+a*t;this.n44=v*F+r*L+k*A+a*b;c[0]=this.n11;c[1]=this.n21;c[2]=this.n31;c[3]=this.n41;c[4]=this.n12;c[5]=this.n22;c[6]=this.n32;c[7]=this.n42;c[8]=this.n13;c[9]=this.n23;c[10]=this.n33;c[11]=this.n43;c[12]=this.n14;c[13]=this.n24;c[14]=this.n34;
c[15]=this.n44;return this},multiplySelf:function(a){var b=this.n11,c=this.n12,d=this.n13,e=this.n14,f=this.n21,i=this.n22,j=this.n23,g=this.n24,h=this.n31,m=this.n32,l=this.n33,o=this.n34,p=this.n41,u=this.n42,v=this.n43,r=this.n44,k=a.n11,E=a.n21,C=a.n31,K=a.n41,F=a.n12,P=a.n22,D=a.n32,x=a.n42,L=a.n13,y=a.n23,H=a.n33,w=a.n43,A=a.n14,s=a.n24,N=a.n34;a=a.n44;this.n11=b*k+c*E+d*C+e*K;this.n12=b*F+c*P+d*D+e*x;this.n13=b*L+c*y+d*H+e*w;this.n14=b*A+c*s+d*N+e*a;this.n21=f*k+i*E+j*C+g*K;this.n22=f*F+i*
P+j*D+g*x;this.n23=f*L+i*y+j*H+g*w;this.n24=f*A+i*s+j*N+g*a;this.n31=h*k+m*E+l*C+o*K;this.n32=h*F+m*P+l*D+o*x;this.n33=h*L+m*y+l*H+o*w;this.n34=h*A+m*s+l*N+o*a;this.n41=p*k+u*E+v*C+r*K;this.n42=p*F+u*P+v*D+r*x;this.n43=p*L+u*y+v*H+r*w;this.n44=p*A+u*s+v*N+r*a;return this},multiplyScalar:function(a){this.n11*=a;this.n12*=a;this.n13*=a;this.n14*=a;this.n21*=a;this.n22*=a;this.n23*=a;this.n24*=a;this.n31*=a;this.n32*=a;this.n33*=a;this.n34*=a;this.n41*=a;this.n42*=a;this.n43*=a;this.n44*=a;return this},
determinant:function(){var a=this.n11,b=this.n12,c=this.n13,d=this.n14,e=this.n21,f=this.n22,i=this.n23,j=this.n24,g=this.n31,h=this.n32,m=this.n33,l=this.n34,o=this.n41,p=this.n42,u=this.n43,v=this.n44;return d*i*h*o-c*j*h*o-d*f*m*o+b*j*m*o+c*f*l*o-b*i*l*o-d*i*g*p+c*j*g*p+d*e*m*p-a*j*m*p-c*e*l*p+a*i*l*p+d*f*g*u-b*j*g*u-d*e*h*u+a*j*h*u+b*e*l*u-a*f*l*u-c*f*g*v+b*i*g*v+c*e*h*v-a*i*h*v-b*e*m*v+a*f*m*v},transpose:function(){function a(b,c,d){var e=b[c];b[c]=b[d];b[d]=e}a(this,"n21","n12");a(this,"n31",
"n13");a(this,"n32","n23");a(this,"n41","n14");a(this,"n42","n24");a(this,"n43","n34");return this},clone:function(){var a=new THREE.Matrix4;a.n11=this.n11;a.n12=this.n12;a.n13=this.n13;a.n14=this.n14;a.n21=this.n21;a.n22=this.n22;a.n23=this.n23;a.n24=this.n24;a.n31=this.n31;a.n32=this.n32;a.n33=this.n33;a.n34=this.n34;a.n41=this.n41;a.n42=this.n42;a.n43=this.n43;a.n44=this.n44;return a},flatten:function(){var a=this.flat;a[0]=this.n11;a[1]=this.n21;a[2]=this.n31;a[3]=this.n41;a[4]=this.n12;a[5]=
this.n22;a[6]=this.n32;a[7]=this.n42;a[8]=this.n13;a[9]=this.n23;a[10]=this.n33;a[11]=this.n43;a[12]=this.n14;a[13]=this.n24;a[14]=this.n34;a[15]=this.n44;return a},setTranslation:function(a,b,c){this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1);return this},setScale:function(a,b,c){this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1);return this},setRotX:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(1,0,0,0,0,b,-a,0,0,a,b,0,0,0,0,1);return this},setRotY:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,
0,a,0,0,1,0,0,-a,0,b,0,0,0,0,1);return this},setRotZ:function(a){var b=Math.cos(a);a=Math.sin(a);this.set(b,-a,0,0,a,b,0,0,0,0,1,0,0,0,0,1);return this},setRotAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,i=a.y,j=a.z,g=e*f,h=e*i;this.set(g*f+c,g*i-d*j,g*j+d*i,0,g*i+d*j,h*i+c,h*j-d*f,0,g*j-d*i,h*j+d*f,e*j*j+c,0,0,0,0,1);return this},toString:function(){return"| "+this.n11+" "+this.n12+" "+this.n13+" "+this.n14+" |\n| "+this.n21+" "+this.n22+" "+this.n23+" "+this.n24+" |\n| "+this.n31+
" "+this.n32+" "+this.n33+" "+this.n34+" |\n| "+this.n41+" "+this.n42+" "+this.n43+" "+this.n44+" |"}};THREE.Matrix4.translationMatrix=function(a,b,c){var d=new THREE.Matrix4;d.setTranslation(a,b,c);return d};THREE.Matrix4.scaleMatrix=function(a,b,c){var d=new THREE.Matrix4;d.setScale(a,b,c);return d};THREE.Matrix4.rotationXMatrix=function(a){var b=new THREE.Matrix4;b.setRotX(a);return b};THREE.Matrix4.rotationYMatrix=function(a){var b=new THREE.Matrix4;b.setRotY(a);return b};
THREE.Matrix4.rotationZMatrix=function(a){var b=new THREE.Matrix4;b.setRotZ(a);return b};THREE.Matrix4.rotationAxisAngleMatrix=function(a,b){var c=new THREE.Matrix4;c.setRotAxis(a,b);return c};
THREE.Matrix4.makeInvert=function(a){var b=a.n11,c=a.n12,d=a.n13,e=a.n14,f=a.n21,i=a.n22,j=a.n23,g=a.n24,h=a.n31,m=a.n32,l=a.n33,o=a.n34,p=a.n41,u=a.n42,v=a.n43,r=a.n44,k=new THREE.Matrix4;k.n11=j*o*u-g*l*u+g*m*v-i*o*v-j*m*r+i*l*r;k.n12=e*l*u-d*o*u-e*m*v+c*o*v+d*m*r-c*l*r;k.n13=d*g*u-e*j*u+e*i*v-c*g*v-d*i*r+c*j*r;k.n14=e*j*m-d*g*m-e*i*l+c*g*l+d*i*o-c*j*o;k.n21=g*l*p-j*o*p-g*h*v+f*o*v+j*h*r-f*l*r;k.n22=d*o*p-e*l*p+e*h*v-b*o*v-d*h*r+b*l*r;k.n23=e*j*p-d*g*p-e*f*v+b*g*v+d*f*r-b*j*r;k.n24=d*g*h-e*j*h+
e*f*l-b*g*l-d*f*o+b*j*o;k.n31=i*o*p-g*m*p+g*h*u-f*o*u-i*h*r+f*m*r;k.n32=e*m*p-c*o*p-e*h*u+b*o*u+c*h*r-b*m*r;k.n33=d*g*p-e*i*p+e*f*u-b*g*u-c*f*r+b*i*r;k.n34=e*i*h-c*g*h-e*f*m+b*g*m+c*f*o-b*i*o;k.n41=j*m*p-i*l*p-j*h*u+f*l*u+i*h*v-f*m*v;k.n42=c*l*p-d*m*p+d*h*u-b*l*u-c*h*v+b*m*v;k.n43=d*i*p-c*j*p-d*f*u+b*j*u+c*f*v-b*i*v;k.n44=c*j*h-d*i*h+d*f*m-b*j*m-c*f*l+b*i*l;k.multiplyScalar(1/a.determinant());return k};
THREE.Matrix4.makeInvert3x3=function(a){var b=a.flatten();a=a.m33;var c=a.m,d=b[10]*b[5]-b[6]*b[9],e=-b[10]*b[1]+b[2]*b[9],f=b[6]*b[1]-b[2]*b[5],i=-b[10]*b[4]+b[6]*b[8],j=b[10]*b[0]-b[2]*b[8],g=-b[6]*b[0]+b[2]*b[4],h=b[9]*b[4]-b[5]*b[8],m=-b[9]*b[0]+b[1]*b[8],l=b[5]*b[0]-b[1]*b[4];b=b[0]*d+b[1]*i+b[2]*h;if(b==0)throw"matrix not invertible";b=1/b;c[0]=b*d;c[1]=b*e;c[2]=b*f;c[3]=b*i;c[4]=b*j;c[5]=b*g;c[6]=b*h;c[7]=b*m;c[8]=b*l;return a};
THREE.Matrix4.makeFrustum=function(a,b,c,d,e,f){var i,j,g;i=new THREE.Matrix4;j=2*e/(b-a);g=2*e/(d-c);a=(b+a)/(b-a);c=(d+c)/(d-c);d=-(f+e)/(f-e);e=-2*f*e/(f-e);i.n11=j;i.n12=0;i.n13=a;i.n14=0;i.n21=0;i.n22=g;i.n23=c;i.n24=0;i.n31=0;i.n32=0;i.n33=d;i.n34=e;i.n41=0;i.n42=0;i.n43=-1;i.n44=0;return i};THREE.Matrix4.makePerspective=function(a,b,c,d){var e;a=c*Math.tan(a*Math.PI/360);e=-a;return THREE.Matrix4.makeFrustum(e*b,a*b,e,a,c,d)};
THREE.Matrix4.makeOrtho=function(a,b,c,d,e,f){var i,j,g,h;i=new THREE.Matrix4;j=b-a;g=c-d;h=f-e;a=(b+a)/j;c=(c+d)/g;e=(f+e)/h;i.n11=2/j;i.n12=0;i.n13=0;i.n14=-a;i.n21=0;i.n22=2/g;i.n23=0;i.n24=-c;i.n31=0;i.n32=0;i.n33=-2/h;i.n34=-e;i.n41=0;i.n42=0;i.n43=0;i.n44=1;return i};THREE.Matrix4.__tmpVec1=new THREE.Vector3;THREE.Matrix4.__tmpVec2=new THREE.Vector3;THREE.Matrix4.__tmpVec3=new THREE.Vector3;THREE.Vertex=function(a,b){this.position=a||new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.normal=b||new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.normalScreen=new THREE.Vector3;this.tangent=new THREE.Vector4;this.__visible=true};THREE.Vertex.prototype={toString:function(){return"THREE.Vertex ( position: "+this.position+", normal: "+this.normal+" )"}};THREE.Light=function(a){this.color=new THREE.Color(a)};THREE.AmbientLight=function(a){THREE.Light.call(this,a)};THREE.AmbientLight.prototype=new THREE.Light;THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(a,b){THREE.Light.call(this,a);this.position=new THREE.Vector3(0,1,0);this.intensity=b||1};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(a,b){THREE.Light.call(this,a);this.position=new THREE.Vector3;this.intensity=b||1};THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.RenderableObject=function(){this.z=this.object=null};THREE.RenderableFace3=function(){this.z=null;this.v1=new THREE.Vertex;this.v2=new THREE.Vertex;this.v3=new THREE.Vertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[];this.faceMaterials=this.meshMaterials=null;this.overdraw=false;this.uvs=[null,null,null]};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.Vertex;this.v2=new THREE.Vertex;this.materials=null};THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new THREE.Vector2;this.materials=null};THREE.Projector=function(){function a(D,x){return x.z-D.z}function b(D,x){var L=0,y=1,H=D.z+D.w,w=x.z+x.w,A=-D.z+D.w,s=-x.z+x.w;if(H>=0&&w>=0&&A>=0&&s>=0)return true;else if(H<0&&w<0||A<0&&s<0)return false;else{if(H<0)L=Math.max(L,H/(H-w));else if(w<0)y=Math.min(y,H/(H-w));if(A<0)L=Math.max(L,A/(A-s));else if(s<0)y=Math.min(y,A/(A-s));if(y<L)return false;else{D.lerpSelf(x,L);x.lerpSelf(D,1-y);return true}}}var c,d,e=[],f,i,j,g=[],h,m,l=[],o,p,u=[],v=new THREE.Vector4,r=new THREE.Vector4,k=new THREE.Matrix4,
E=new THREE.Matrix4,C=[],K=new THREE.Vector4,F=new THREE.Vector4,P;this.projectObjects=function(D,x,L){var y=[],H,w;d=0;k.multiply(x.projectionMatrix,x.matrix);C[0]=new THREE.Vector4(k.n41-k.n11,k.n42-k.n12,k.n43-k.n13,k.n44-k.n14);C[1]=new THREE.Vector4(k.n41+k.n11,k.n42+k.n12,k.n43+k.n13,k.n44+k.n14);C[2]=new THREE.Vector4(k.n41+k.n21,k.n42+k.n22,k.n43+k.n23,k.n44+k.n24);C[3]=new THREE.Vector4(k.n41-k.n21,k.n42-k.n22,k.n43-k.n23,k.n44-k.n24);C[4]=new THREE.Vector4(k.n41-k.n31,k.n42-k.n32,k.n43-
k.n33,k.n44-k.n34);C[5]=new THREE.Vector4(k.n41+k.n31,k.n42+k.n32,k.n43+k.n33,k.n44+k.n34);x=0;for(H=C.length;x<H;x++){w=C[x];w.divideScalar(Math.sqrt(w.x*w.x+w.y*w.y+w.z*w.z))}H=D.objects;D=0;for(x=H.length;D<x;D++){w=H[D];var A;if(!(A=!w.visible)){if(A=w instanceof THREE.Mesh){a:{A=void 0;for(var s=w.position,N=-w.geometry.boundingSphere.radius*Math.max(w.scale.x,Math.max(w.scale.y,w.scale.z)),t=0;t<6;t++){A=C[t].x*s.x+C[t].y*s.y+C[t].z*s.z+C[t].w;if(A<=N){A=false;break a}}A=true}A=!A}A=A}if(!A){c=
e[d]=e[d]||new THREE.RenderableObject;v.copy(w.position);k.multiplyVector3(v);c.object=w;c.z=v.z;y.push(c);d++}}L&&y.sort(a);return y};this.projectScene=function(D,x,L){var y=[],H=x.near,w=x.far,A,s,N,t,O,ia,J,ja,ka,la,ma,Z,Q,I,U,R;j=m=p=0;x.autoUpdateMatrix&&x.updateMatrix();k.multiply(x.projectionMatrix,x.matrix);ia=this.projectObjects(D,x,true);D=0;for(A=ia.length;D<A;D++){J=ia[D].object;if(J.visible){J.autoUpdateMatrix&&J.updateMatrix();ja=J.matrix;ka=J.rotationMatrix;la=J.materials;ma=J.overdraw;
if(J instanceof THREE.Mesh){Z=J.geometry;Q=Z.vertices;s=0;for(N=Q.length;s<N;s++){I=Q[s];I.positionWorld.copy(I.position);ja.multiplyVector3(I.positionWorld);t=I.positionScreen;t.copy(I.positionWorld);k.multiplyVector4(t);t.x/=t.w;t.y/=t.w;I.__visible=t.z>H&&t.z<w}Z=Z.faces;s=0;for(N=Z.length;s<N;s++){I=Z[s];if(I instanceof THREE.Face3){t=Q[I.a];O=Q[I.b];U=Q[I.c];if(t.__visible&&O.__visible&&U.__visible)if(J.doubleSided||J.flipSided!=(U.positionScreen.x-t.positionScreen.x)*(O.positionScreen.y-t.positionScreen.y)-
(U.positionScreen.y-t.positionScreen.y)*(O.positionScreen.x-t.positionScreen.x)<0){f=g[j]=g[j]||new THREE.RenderableFace3;f.v1.positionWorld.copy(t.positionWorld);f.v2.positionWorld.copy(O.positionWorld);f.v3.positionWorld.copy(U.positionWorld);f.v1.positionScreen.copy(t.positionScreen);f.v2.positionScreen.copy(O.positionScreen);f.v3.positionScreen.copy(U.positionScreen);f.normalWorld.copy(I.normal);ka.multiplyVector3(f.normalWorld);f.centroidWorld.copy(I.centroid);ja.multiplyVector3(f.centroidWorld);
f.centroidScreen.copy(f.centroidWorld);k.multiplyVector3(f.centroidScreen);U=I.vertexNormals;P=f.vertexNormalsWorld;t=0;for(O=U.length;t<O;t++){R=P[t]=P[t]||new THREE.Vector3;R.copy(U[t]);ka.multiplyVector3(R)}f.z=f.centroidScreen.z;f.meshMaterials=la;f.faceMaterials=I.materials;f.overdraw=ma;if(J.geometry.uvs[s]){f.uvs[0]=J.geometry.uvs[s][0];f.uvs[1]=J.geometry.uvs[s][1];f.uvs[2]=J.geometry.uvs[s][2]}y.push(f);j++}}else if(I instanceof THREE.Face4){t=Q[I.a];O=Q[I.b];U=Q[I.c];R=Q[I.d];if(t.__visible&&
O.__visible&&U.__visible&&R.__visible)if(J.doubleSided||J.flipSided!=((R.positionScreen.x-t.positionScreen.x)*(O.positionScreen.y-t.positionScreen.y)-(R.positionScreen.y-t.positionScreen.y)*(O.positionScreen.x-t.positionScreen.x)<0||(O.positionScreen.x-U.positionScreen.x)*(R.positionScreen.y-U.positionScreen.y)-(O.positionScreen.y-U.positionScreen.y)*(R.positionScreen.x-U.positionScreen.x)<0)){f=g[j]=g[j]||new THREE.RenderableFace3;f.v1.positionWorld.copy(t.positionWorld);f.v2.positionWorld.copy(O.positionWorld);
f.v3.positionWorld.copy(R.positionWorld);f.v1.positionScreen.copy(t.positionScreen);f.v2.positionScreen.copy(O.positionScreen);f.v3.positionScreen.copy(R.positionScreen);f.normalWorld.copy(I.normal);ka.multiplyVector3(f.normalWorld);f.centroidWorld.copy(I.centroid);ja.multiplyVector3(f.centroidWorld);f.centroidScreen.copy(f.centroidWorld);k.multiplyVector3(f.centroidScreen);f.z=f.centroidScreen.z;f.meshMaterials=la;f.faceMaterials=I.materials;f.overdraw=ma;if(J.geometry.uvs[s]){f.uvs[0]=J.geometry.uvs[s][0];
f.uvs[1]=J.geometry.uvs[s][1];f.uvs[2]=J.geometry.uvs[s][3]}y.push(f);j++;i=g[j]=g[j]||new THREE.RenderableFace3;i.v1.positionWorld.copy(O.positionWorld);i.v2.positionWorld.copy(U.positionWorld);i.v3.positionWorld.copy(R.positionWorld);i.v1.positionScreen.copy(O.positionScreen);i.v2.positionScreen.copy(U.positionScreen);i.v3.positionScreen.copy(R.positionScreen);i.normalWorld.copy(f.normalWorld);i.centroidWorld.copy(f.centroidWorld);i.centroidScreen.copy(f.centroidScreen);i.z=i.centroidScreen.z;i.meshMaterials=
la;i.faceMaterials=I.materials;i.overdraw=ma;if(J.geometry.uvs[s]){i.uvs[0]=J.geometry.uvs[s][1];i.uvs[1]=J.geometry.uvs[s][2];i.uvs[2]=J.geometry.uvs[s][3]}y.push(i);j++}}}}else if(J instanceof THREE.Line){E.multiply(k,ja);Q=J.geometry.vertices;I=Q[0];I.positionScreen.copy(I.position);E.multiplyVector4(I.positionScreen);s=1;for(N=Q.length;s<N;s++){t=Q[s];t.positionScreen.copy(t.position);E.multiplyVector4(t.positionScreen);O=Q[s-1];K.copy(t.positionScreen);F.copy(O.positionScreen);if(b(K,F)){K.multiplyScalar(1/
K.w);F.multiplyScalar(1/F.w);h=l[m]=l[m]||new THREE.RenderableLine;h.v1.positionScreen.copy(K);h.v2.positionScreen.copy(F);h.z=Math.max(K.z,F.z);h.materials=J.materials;y.push(h);m++}}}else if(J instanceof THREE.Particle){r.set(J.position.x,J.position.y,J.position.z,1);k.multiplyVector4(r);r.z/=r.w;if(r.z>0&&r.z<1){o=u[p]=u[p]||new THREE.RenderableParticle;o.x=r.x/r.w;o.y=r.y/r.w;o.z=r.z;o.rotation=J.rotation.z;o.scale.x=J.scale.x*Math.abs(o.x-(r.x+x.projectionMatrix.n11)/(r.w+x.projectionMatrix.n14));
o.scale.y=J.scale.y*Math.abs(o.y-(r.y+x.projectionMatrix.n22)/(r.w+x.projectionMatrix.n24));o.materials=J.materials;y.push(o);p++}}}}L&&y.sort(a);return y};this.unprojectVector=function(D,x){var L=THREE.Matrix4.makeInvert(x.matrix);L.multiplySelf(THREE.Matrix4.makeInvert(x.projectionMatrix));L.multiplyVector3(D);return D}};THREE.CanvasRenderer=function(){function a(V){if(o!=V)h.globalAlpha=o=V}function b(V){if(p!=V){switch(V){case THREE.NormalBlending:h.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:h.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:h.globalCompositeOperation="darker"}p=V}}var c=null,d=new THREE.Projector,e=document.createElement("canvas"),f,i,j,g,h=e.getContext("2d"),m=new THREE.Color(0),l=0,o=1,p=0,u=null,v=null,r=1,k,E,C,K,F,P,D,x,L,y=new THREE.Color,
H=new THREE.Color,w=new THREE.Color,A=new THREE.Color,s=new THREE.Color,N,t,O,ia,J,ja,ka,la,ma,Z=new THREE.Rectangle,Q=new THREE.Rectangle,I=new THREE.Rectangle,U=false,R=new THREE.Color,$=new THREE.Color,na=new THREE.Color,oa=new THREE.Color,La=Math.PI*2,S=new THREE.Vector3,ra,sa,Ca,aa,ta,xa,pa=16;ra=document.createElement("canvas");ra.width=ra.height=2;sa=ra.getContext("2d");sa.fillStyle="rgba(0,0,0,1)";sa.fillRect(0,0,2,2);Ca=sa.getImageData(0,0,2,2);aa=Ca.data;ta=document.createElement("canvas");
ta.width=ta.height=pa;xa=ta.getContext("2d");xa.translate(-pa/2,-pa/2);xa.scale(pa,pa);pa--;this.domElement=e;this.sortElements=this.sortObjects=this.autoClear=true;this.setSize=function(V,ca){f=V;i=ca;j=f/2;g=i/2;e.width=f;e.height=i;Z.set(-j,-g,j,g);o=1;p=0;v=u=null;r=1};this.setClearColor=function(V,ca){m=V;l=ca;Q.set(-j,-g,j,g);h.setTransform(1,0,0,-1,j,g);this.clear()};this.setClearColorHex=function(V,ca){m.setHex(V);l=ca;Q.set(-j,-g,j,g);h.setTransform(1,0,0,-1,j,g);this.clear()};this.clear=
function(){h.setTransform(1,0,0,-1,j,g);if(!Q.isEmpty()){Q.inflate(1);Q.minSelf(Z);if(m.hex==0&&l==0)h.clearRect(Q.getX(),Q.getY(),Q.getWidth(),Q.getHeight());else{b(THREE.NormalBlending);a(1);h.fillStyle="rgba("+Math.floor(m.r*255)+","+Math.floor(m.g*255)+","+Math.floor(m.b*255)+","+l+")";h.fillRect(Q.getX(),Q.getY(),Q.getWidth(),Q.getHeight())}Q.empty()}};this.render=function(V,ca){function Ma(n){var G,B,q,z=n.lights;$.setRGB(0,0,0);na.setRGB(0,0,0);oa.setRGB(0,0,0);n=0;for(G=z.length;n<G;n++){B=
z[n];q=B.color;if(B instanceof THREE.AmbientLight){$.r+=q.r;$.g+=q.g;$.b+=q.b}else if(B instanceof THREE.DirectionalLight){na.r+=q.r;na.g+=q.g;na.b+=q.b}else if(B instanceof THREE.PointLight){oa.r+=q.r;oa.g+=q.g;oa.b+=q.b}}}function ya(n,G,B,q){var z,M,W,X,Y=n.lights;n=0;for(z=Y.length;n<z;n++){M=Y[n];W=M.color;X=M.intensity;if(M instanceof THREE.DirectionalLight){M=B.dot(M.position)*X;if(M>0){q.r+=W.r*M;q.g+=W.g*M;q.b+=W.b*M}}else if(M instanceof THREE.PointLight){S.sub(M.position,G);S.normalize();
M=B.dot(S)*X;if(M>0){q.r+=W.r*M;q.g+=W.g*M;q.b+=W.b*M}}}}function Na(n,G,B){if(B.opacity!=0){a(B.opacity);b(B.blending);var q,z,M,W,X,Y;if(B instanceof THREE.ParticleBasicMaterial){if(B.map&&B.map.image.loaded){W=B.map.image;X=W.width>>1;Y=W.height>>1;z=G.scale.x*j;M=G.scale.y*g;B=z*X;q=M*Y;I.set(n.x-B,n.y-q,n.x+B,n.y+q);if(Z.instersects(I)){h.save();h.translate(n.x,n.y);h.rotate(-G.rotation);h.scale(z,-M);h.translate(-X,-Y);h.drawImage(W,0,0);h.restore()}}}else if(B instanceof THREE.ParticleCircleMaterial){if(U){R.r=
$.r+na.r+oa.r;R.g=$.g+na.g+oa.g;R.b=$.b+na.b+oa.b;y.r=B.color.r*R.r;y.g=B.color.g*R.g;y.b=B.color.b*R.b;y.updateStyleString()}else y.__styleString=B.color.__styleString;B=G.scale.x*j;q=G.scale.y*g;I.set(n.x-B,n.y-q,n.x+B,n.y+q);if(Z.instersects(I)){z=y.__styleString;if(v!=z)h.fillStyle=v=z;h.save();h.translate(n.x,n.y);h.rotate(-G.rotation);h.scale(B,q);h.beginPath();h.arc(0,0,1,0,La,true);h.closePath();h.fill();h.restore()}}}}function Oa(n,G,B,q){if(q.opacity!=0){a(q.opacity);b(q.blending);h.beginPath();
h.moveTo(n.positionScreen.x,n.positionScreen.y);h.lineTo(G.positionScreen.x,G.positionScreen.y);h.closePath();if(q instanceof THREE.LineBasicMaterial){y.__styleString=q.color.__styleString;n=q.linewidth;if(r!=n)h.lineWidth=r=n;n=y.__styleString;if(u!=n)h.strokeStyle=u=n;h.stroke();I.inflate(q.linewidth*2)}}}function Ha(n,G,B,q,z,M){if(z.opacity!=0){a(z.opacity);b(z.blending);K=n.positionScreen.x;F=n.positionScreen.y;P=G.positionScreen.x;D=G.positionScreen.y;x=B.positionScreen.x;L=B.positionScreen.y;
h.beginPath();h.moveTo(K,F);h.lineTo(P,D);h.lineTo(x,L);h.lineTo(K,F);h.closePath();if(z instanceof THREE.MeshBasicMaterial)if(z.map)z.map.image.loaded&&z.map.mapping instanceof THREE.UVMapping&&ua(K,F,P,D,x,L,z.map.image,q.uvs[0].u,q.uvs[0].v,q.uvs[1].u,q.uvs[1].v,q.uvs[2].u,q.uvs[2].v);else if(z.env_map){if(z.env_map.image.loaded)if(z.env_map.mapping instanceof THREE.SphericalReflectionMapping){n=ca.matrix;S.copy(q.vertexNormalsWorld[0]);ia=(S.x*n.n11+S.y*n.n12+S.z*n.n13)*0.5+0.5;J=-(S.x*n.n21+
S.y*n.n22+S.z*n.n23)*0.5+0.5;S.copy(q.vertexNormalsWorld[1]);ja=(S.x*n.n11+S.y*n.n12+S.z*n.n13)*0.5+0.5;ka=-(S.x*n.n21+S.y*n.n22+S.z*n.n23)*0.5+0.5;S.copy(q.vertexNormalsWorld[2]);la=(S.x*n.n11+S.y*n.n12+S.z*n.n13)*0.5+0.5;ma=-(S.x*n.n21+S.y*n.n22+S.z*n.n23)*0.5+0.5;ua(K,F,P,D,x,L,z.env_map.image,ia,J,ja,ka,la,ma)}}else z.wireframe?za(z.color.__styleString,z.wireframe_linewidth):Aa(z.color.__styleString);else if(z instanceof THREE.MeshLambertMaterial){if(z.map&&!z.wireframe){z.map.mapping instanceof
THREE.UVMapping&&ua(K,F,P,D,x,L,z.map.image,q.uvs[0].u,q.uvs[0].v,q.uvs[1].u,q.uvs[1].v,q.uvs[2].u,q.uvs[2].v);b(THREE.SubtractiveBlending)}if(U)if(!z.wireframe&&z.shading==THREE.SmoothShading&&q.vertexNormalsWorld.length==3){H.r=w.r=A.r=$.r;H.g=w.g=A.g=$.g;H.b=w.b=A.b=$.b;ya(M,q.v1.positionWorld,q.vertexNormalsWorld[0],H);ya(M,q.v2.positionWorld,q.vertexNormalsWorld[1],w);ya(M,q.v3.positionWorld,q.vertexNormalsWorld[2],A);s.r=(w.r+A.r)*0.5;s.g=(w.g+A.g)*0.5;s.b=(w.b+A.b)*0.5;O=Ia(H,w,A,s);ua(K,F,
P,D,x,L,O,0,0,1,0,0,1)}else{R.r=$.r;R.g=$.g;R.b=$.b;ya(M,q.centroidWorld,q.normalWorld,R);y.r=z.color.r*R.r;y.g=z.color.g*R.g;y.b=z.color.b*R.b;y.updateStyleString();z.wireframe?za(y.__styleString,z.wireframe_linewidth):Aa(y.__styleString)}else z.wireframe?za(z.color.__styleString,z.wireframe_linewidth):Aa(z.color.__styleString)}else if(z instanceof THREE.MeshDepthMaterial){N=ca.near;t=ca.far;H.r=H.g=H.b=1-Da(n.positionScreen.z,N,t);w.r=w.g=w.b=1-Da(G.positionScreen.z,N,t);A.r=A.g=A.b=1-Da(B.positionScreen.z,
N,t);s.r=(w.r+A.r)*0.5;s.g=(w.g+A.g)*0.5;s.b=(w.b+A.b)*0.5;O=Ia(H,w,A,s);ua(K,F,P,D,x,L,O,0,0,1,0,0,1)}else if(z instanceof THREE.MeshNormalMaterial){y.r=Ea(q.normalWorld.x);y.g=Ea(q.normalWorld.y);y.b=Ea(q.normalWorld.z);y.updateStyleString();z.wireframe?za(y.__styleString,z.wireframe_linewidth):Aa(y.__styleString)}}}function za(n,G){if(u!=n)h.strokeStyle=u=n;if(r!=G)h.lineWidth=r=G;h.stroke();I.inflate(G*2)}function Aa(n){if(v!=n)h.fillStyle=v=n;h.fill()}function ua(n,G,B,q,z,M,W,X,Y,fa,ba,ga,va){var da,
ha;da=W.width-1;ha=W.height-1;X*=da;Y*=ha;fa*=da;ba*=ha;ga*=da;va*=ha;B-=n;q-=G;z-=n;M-=G;fa-=X;ba-=Y;ga-=X;va-=Y;da=fa*va-ga*ba;if(da!=0){ha=1/da;da=(va*B-ba*z)*ha;ba=(va*q-ba*M)*ha;B=(fa*z-ga*B)*ha;q=(fa*M-ga*q)*ha;n=n-da*X-B*Y;G=G-ba*X-q*Y;h.save();h.transform(da,ba,B,q,n,G);h.clip();h.drawImage(W,0,0);h.restore()}}function Ia(n,G,B,q){var z=~~(n.r*255),M=~~(n.g*255);n=~~(n.b*255);var W=~~(G.r*255),X=~~(G.g*255);G=~~(G.b*255);var Y=~~(B.r*255),fa=~~(B.g*255);B=~~(B.b*255);var ba=~~(q.r*255),ga=
~~(q.g*255);q=~~(q.b*255);aa[0]=z<0?0:z>255?255:z;aa[1]=M<0?0:M>255?255:M;aa[2]=n<0?0:n>255?255:n;aa[4]=W<0?0:W>255?255:W;aa[5]=X<0?0:X>255?255:X;aa[6]=G<0?0:G>255?255:G;aa[8]=Y<0?0:Y>255?255:Y;aa[9]=fa<0?0:fa>255?255:fa;aa[10]=B<0?0:B>255?255:B;aa[12]=ba<0?0:ba>255?255:ba;aa[13]=ga<0?0:ga>255?255:ga;aa[14]=q<0?0:q>255?255:q;sa.putImageData(Ca,0,0);xa.drawImage(ra,0,0);return ta}function Da(n,G,B){n=(n-G)/(B-G);return n*n*(3-2*n)}function Ea(n){n=(n+1)*0.5;return n<0?0:n>1?1:n}function Fa(n,G){var B=
G.x-n.x,q=G.y-n.y,z=1/Math.sqrt(B*B+q*q);B*=z;q*=z;G.x+=B;G.y+=q;n.x-=B;n.y-=q}var Ba,Ja,T,ea,qa,Ga,Ka,wa;this.autoClear?this.clear():h.setTransform(1,0,0,-1,j,g);c=d.projectScene(V,ca,this.sortElements);(U=V.lights.length>0)&&Ma(V);Ba=0;for(Ja=c.length;Ba<Ja;Ba++){T=c[Ba];I.empty();if(T instanceof THREE.RenderableParticle){k=T;k.x*=j;k.y*=g;ea=0;for(qa=T.materials.length;ea<qa;ea++)Na(k,T,T.materials[ea],V)}else if(T instanceof THREE.RenderableLine){k=T.v1;E=T.v2;k.positionScreen.x*=j;k.positionScreen.y*=
g;E.positionScreen.x*=j;E.positionScreen.y*=g;I.addPoint(k.positionScreen.x,k.positionScreen.y);I.addPoint(E.positionScreen.x,E.positionScreen.y);if(Z.instersects(I)){ea=0;for(qa=T.materials.length;ea<qa;)Oa(k,E,T,T.materials[ea++],V)}}else if(T instanceof THREE.RenderableFace3){k=T.v1;E=T.v2;C=T.v3;k.positionScreen.x*=j;k.positionScreen.y*=g;E.positionScreen.x*=j;E.positionScreen.y*=g;C.positionScreen.x*=j;C.positionScreen.y*=g;if(T.overdraw){Fa(k.positionScreen,E.positionScreen);Fa(E.positionScreen,
C.positionScreen);Fa(C.positionScreen,k.positionScreen)}I.add3Points(k.positionScreen.x,k.positionScreen.y,E.positionScreen.x,E.positionScreen.y,C.positionScreen.x,C.positionScreen.y);if(Z.instersects(I)){ea=0;for(qa=T.meshMaterials.length;ea<qa;){wa=T.meshMaterials[ea++];if(wa instanceof THREE.MeshFaceMaterial){Ga=0;for(Ka=T.faceMaterials.length;Ga<Ka;)(wa=T.faceMaterials[Ga++])&&Ha(k,E,C,T,wa,V)}else Ha(k,E,C,T,wa,V)}}}Q.addRectangle(I)}h.setTransform(1,0,0,1,0,0)}};THREE.Camera=function(a,b,c,d){this.fov=a;this.aspect=b;this.near=c;this.far=d;this.position=new THREE.Vector3;this.target={position:new THREE.Vector3};this.autoUpdateMatrix=true;this.projectionMatrix=null;this.matrix=new THREE.Matrix4;this.up=new THREE.Vector3(0,1,0);this.tmpVec=new THREE.Vector3;this.translateX=function(e){this.tmpVec.sub(this.target.position,this.position).normalize().multiplyScalar(e);this.tmpVec.crossSelf(this.up);this.position.addSelf(this.tmpVec);this.target.position.addSelf(this.tmpVec)};
this.translateZ=function(e){this.tmpVec.sub(this.target.position,this.position).normalize().multiplyScalar(e);this.position.subSelf(this.tmpVec);this.target.position.subSelf(this.tmpVec)};this.updateMatrix=function(){this.matrix.lookAt(this.position,this.target.position,this.up)};this.updateProjectionMatrix=function(){this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)};this.updateProjectionMatrix()};
THREE.Camera.prototype={toString:function(){return"THREE.Camera ( "+this.position+", "+this.target.position+" )"}};THREE.Scene=function(){this.objects=[];this.lights=[];this.fog=null;this.addObject=function(a){this.objects.indexOf(a)===-1&&this.objects.push(a)};this.removeObject=function(a){a=this.objects.indexOf(a);a!==-1&&this.objects.splice(a,1)};this.addLight=function(a){this.lights.indexOf(a)===-1&&this.lights.push(a)};this.removeLight=function(a){a=this.lights.indexOf(a);a!==-1&&this.lights.splice(a,1)};this.exportObj=function(a){var b,c,d,e,f,i,j,g,h=this.objects,m="# "+(a||"Three.js")+" OBJ\n# "+("Exported from "+
document.location.href)+"\n# On "+new Date+"\n\n";a=0;for(b=h.length;a<b;a++){c=h[a].geometry;e=c.vertices;j=c.faces;m+="g Object"+a+h[a].id+"\n\n";c=0;for(d=e.length;c<d;c++){i=e[c].position;m+="v "+i.x+" "+i.y+" "+i.z+"\n"}m+="\n";c=0;for(d=j.length;c<d;c++){i=j[c];g=[i.a,i.b,i.c];if(i instanceof THREE.Face4)g[3]=i.d;e=0;for(f=g.length;e<f;e++)g[e]=parseInt(g[e])+1;m+="f "+g[0]+" "+g[1]+" "+g[2];m+=i instanceof THREE.Face4?" "+g[3]+"\n":"\n"}}return m};this.toString=function(){return"THREE.Scene ( "+
this.objects+" )"}};THREE.MeshBasicMaterial=function(a){this.id=THREE.MeshBasicMaterialCounter.value++;this.color=new THREE.Color(16777215);this.opacity=1;this.env_map=this.light_map=this.map=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refraction_ratio=0.98;this.fog=true;this.shading=THREE.SmoothShading;this.blending=THREE.NormalBlending;this.depth_test=true;this.wireframe=false;this.wireframe_linewidth=1;this.wireframe_linejoin=this.wireframe_linecap="round";this.vertex_colors=false;if(a){a.color!==
undefined&&this.color.setHex(a.color);if(a.opacity!==undefined)this.opacity=a.opacity;if(a.map!==undefined)this.map=a.map;if(a.light_map!==undefined)this.light_map=a.light_map;if(a.env_map!==undefined)this.env_map=a.env_map;if(a.combine!==undefined)this.combine=a.combine;if(a.reflectivity!==undefined)this.reflectivity=a.reflectivity;if(a.refraction_ratio!==undefined)this.refraction_ratio=a.refraction_ratio;if(a.fog!==undefined)this.fog=a.fog;if(a.shading!==undefined)this.shading=a.shading;if(a.blending!==
undefined)this.blending=a.blending;if(a.depth_test!==undefined)this.depth_test=a.depth_test;if(a.wireframe!==undefined)this.wireframe=a.wireframe;if(a.wireframe_linewidth!==undefined)this.wireframe_linewidth=a.wireframe_linewidth;if(a.wireframe_linecap!==undefined)this.wireframe_linecap=a.wireframe_linecap;if(a.wireframe_linejoin!==undefined)this.wireframe_linejoin=a.wireframe_linejoin;if(a.vertex_colors!==undefined)this.vertex_colors=a.vertex_colors}};
THREE.MeshBasicMaterial.prototype={toString:function(){return"THREE.MeshBasicMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>opacity: "+this.opacity+"<br/>map: "+this.map+"<br/>light_map: "+this.light_map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>blending: "+this.blending+"<br/>depth_test: "+this.depth_test+"<br/>wireframe: "+this.wireframe+"<br/>wireframe_linewidth: "+this.wireframe_linewidth+
"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>vertex_colors: "+this.vertex_colors+"<br/>)"}};THREE.MeshBasicMaterialCounter={value:0};THREE.MeshLambertMaterial=function(a){this.id=THREE.MeshLambertMaterialCounter.value++;this.color=new THREE.Color(16777215);this.opacity=1;this.env_map=this.light_map=this.map=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refraction_ratio=0.98;this.fog=true;this.shading=THREE.SmoothShading;this.blending=THREE.NormalBlending;this.depth_test=true;this.wireframe=false;this.wireframe_linewidth=1;this.wireframe_linejoin=this.wireframe_linecap="round";this.vertex_colors=false;if(a){a.color!==
undefined&&this.color.setHex(a.color);if(a.opacity!==undefined)this.opacity=a.opacity;if(a.map!==undefined)this.map=a.map;if(a.light_map!==undefined)this.light_map=a.light_map;if(a.env_map!==undefined)this.env_map=a.env_map;if(a.combine!==undefined)this.combine=a.combine;if(a.reflectivity!==undefined)this.reflectivity=a.reflectivity;if(a.refraction_ratio!==undefined)this.refraction_ratio=a.refraction_ratio;if(a.fog!==undefined)this.fog=a.fog;if(a.shading!==undefined)this.shading=a.shading;if(a.blending!==
undefined)this.blending=a.blending;if(a.depth_test!==undefined)this.depth_test=a.depth_test;if(a.wireframe!==undefined)this.wireframe=a.wireframe;if(a.wireframe_linewidth!==undefined)this.wireframe_linewidth=a.wireframe_linewidth;if(a.wireframe_linecap!==undefined)this.wireframe_linecap=a.wireframe_linecap;if(a.wireframe_linejoin!==undefined)this.wireframe_linejoin=a.wireframe_linejoin;if(a.vertex_colors!==undefined)this.vertex_colors=a.vertex_colors}};
THREE.MeshLambertMaterial.prototype={toString:function(){return"THREE.MeshLambertMaterial (<br/>id: "+this.id+"<br/>color: "+this.color+"<br/>opacity: "+this.opacity+"<br/>map: "+this.map+"<br/>light_map: "+this.light_map+"<br/>env_map: "+this.env_map+"<br/>combine: "+this.combine+"<br/>reflectivity: "+this.reflectivity+"<br/>refraction_ratio: "+this.refraction_ratio+"<br/>shading: "+this.shading+"<br/>blending: "+this.blending+"<br/>depth_test: "+this.depth_test+"<br/>wireframe: "+this.wireframe+
"<br/>wireframe_linewidth: "+this.wireframe_linewidth+"<br/>wireframe_linecap: "+this.wireframe_linecap+"<br/>wireframe_linejoin: "+this.wireframe_linejoin+"<br/>vertex_colors: "+this.vertex_colors+"<br/> )"}};THREE.MeshLambertMaterialCounter={value:0};THREE.MeshFaceMaterial=function(){};THREE.MeshFaceMaterial.prototype={toString:function(){return"THREE.MeshFaceMaterial"}};THREE.Object3D=function(){this.id=THREE.Object3DCounter.value++;this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.scale=new THREE.Vector3(1,1,1);this.matrix=new THREE.Matrix4;this.rotationMatrix=new THREE.Matrix4;this.tmpMatrix=new THREE.Matrix4;this.screen=new THREE.Vector3;this.visible=this.autoUpdateMatrix=true};
THREE.Object3D.prototype={updateMatrix:function(){var a=this.position,b=this.rotation,c=this.scale,d=this.tmpMatrix;this.matrix.setTranslation(a.x,a.y,a.z);this.rotationMatrix.setRotX(b.x);if(b.y!=0){d.setRotY(b.y);this.rotationMatrix.multiplySelf(d)}if(b.z!=0){d.setRotZ(b.z);this.rotationMatrix.multiplySelf(d)}this.matrix.multiplySelf(this.rotationMatrix);if(c.x!=0||c.y!=0||c.z!=0){d.setScale(c.x,c.y,c.z);this.matrix.multiplySelf(d)}}};THREE.Object3DCounter={value:0};THREE.Mesh=function(a,b){THREE.Object3D.call(this);this.geometry=a;this.materials=b instanceof Array?b:[b];this.overdraw=this.doubleSided=this.flipSided=false;this.geometry.boundingSphere||this.geometry.computeBoundingSphere()};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Line=function(a,b,c){THREE.Object3D.call(this);this.geometry=a;this.materials=b instanceof Array?b:[b];this.type=c!=undefined?c:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;var Plane3E=function(a,b,c,d){THREE.Geometry.call(this);var e=a/2,f=b/2;c=c||1;d=d||1;var i=c+1,j=d+1,g=c-1,h=a/c,m=b/d;for(a=0;a<j;a++)for(b=0;b<i;b++){var l;l=a%2==0;if(!(!l&&b==c)){l=l?b*h-e:b*h-e+h/2;this.vertices.push(new THREE.Vertex(new THREE.Vector3(l,-(a*m-f),0)))}}for(a=0;a<d;a++)for(b=0;b<c;b++){l=a%2==0;f=Math.ceil(a/2);e=b+i*a-Math.floor(a/2);j=b+i*(a+1)-f;h=l?e+1:j+1;this.faces.push(new THREE.Face3(e,j,h));if(b!=g){f=l?h:e;h=l?j:h;l=l?j+1:e+1;this.faces.push(new THREE.Face3(f,h,l))}}this.computeCentroids();
this.computeFaceNormals();this.computeFaceAreas();this.sortFacesByMaterial()};Plane3E.prototype=new THREE.Geometry;Plane3E.prototype.constructor=Plane3E;

